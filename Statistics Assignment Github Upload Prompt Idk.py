# -*- coding: utf-8 -*-
"""Statistics Assignment R Programming.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1G3713qPGRsMEwpntgkLb1c9yrcy_LAYG
"""

# Load the raw dataset directly from working directory
library(dplyr)
library(readr)

raw_data <- read_csv("health_fitness_dataset.csv")

# Check structure
head(raw_data)
colnames(raw_data)
str(raw_data)

# PHASE 1 - DATA CLEANING (Table Output)

# Install required packages
if(!require(dplyr)) install.packages("dplyr")
if(!require(readr)) install.packages("readr")
if(!require(DT)) install.packages("DT")

library(dplyr)
library(readr)
library(DT)

# ✅ 1. Load Raw Dataset
raw_data <- read_csv("health_fitness_dataset.csv")

# ✅ 2. Clean Data & Classify Activity Level
clean_data <- raw_data %>%
  distinct() %>%
  na.omit() %>%
  mutate(Activity_Level = case_when(
    daily_steps < 5000 ~ "Sedentary",
    daily_steps >= 5000 & daily_steps <= 9999 ~ "Moderately Active",
    daily_steps >= 10000 ~ "Active"
  ))

clean_data$Activity_Level <- as.factor(clean_data$Activity_Level)

# ✅ 3. Display Table in Colab (Interactive)
datatable(clean_data, options = list(pageLength = 10, scrollX = TRUE))

# PHASE 1 - TABLE DISPLAY WITH VARIETY (Random 20 Rows)

if(!require(dplyr)) install.packages("dplyr")
if(!require(knitr)) install.packages("knitr")
library(dplyr)
library(knitr)

sampled_data <- clean_data %>% sample_n(20)

kable(
  sampled_data,
  caption = "Randomly Sampled 20 Rows from Cleaned Dataset"
)

write_csv(clean_data, "cleaned_fitbit_data.csv")

# PHASE 2 - TASK A: Large Sample Z-Test


if(!require(BSDA)) install.packages("BSDA")
library(BSDA)

fitbit_data <- read_csv("cleaned_fitbit_data.csv")

active_group <- fitbit_data %>% filter(Activity_Level == "Active")

# Estimate population SD using sample SD
sigma_est <- sd(active_group$daily_steps)

z_test_result <- z.test(
  x = active_group$daily_steps,
  mu = 10000,
  sigma.x = sigma_est,
  alternative = "greater"
)

cat("\nZ-Test Result (Active group > 10,000 steps):\n")
print(z_test_result)

if(!require(lubridate)) install.packages("lubridate")

# PHASE 2 - TASK B: Paired t-Test (Proper Pairing)

library(dplyr)
library(lubridate)

# ✅ 1. Create day_type column based on date
fitbit_data <- fitbit_data %>%
  mutate(day_type = ifelse(weekdays(as.Date(date)) %in% c("Saturday", "Sunday"),
                           "Weekend", "Weekday"))

# ✅ 2. Select 10 random participants with >=7 days of data
set.seed(123) # reproducibility

participants <- fitbit_data %>%
  group_by(participant_id) %>%
  filter(n() >= 7) %>%
  distinct(participant_id) %>%
  slice_sample(n = 10) %>%
  pull(participant_id)

paired_data <- fitbit_data %>% filter(participant_id %in% participants)

# ✅ 3. Calculate mean weekday & weekend steps per participant
paired_summary <- paired_data %>%
  group_by(participant_id, day_type) %>%
  summarise(mean_steps = mean(daily_steps, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = day_type, values_from = mean_steps)

# ✅ 4. Paired t-test using paired weekday-weekend means
t_paired_result <- t.test(paired_summary$Weekday, paired_summary$Weekend, paired = TRUE)

cat("\nPaired t-Test (Weekday vs Weekend daily steps):\n")
print(t_paired_result)

# PHASE 2 - TASK C: Independent Two-Sample t-Test (Corrected)


library(dplyr)

# Extract Sedentary and Active groups' sleep hours
sedentary_sleep <- fitbit_data %>%
  filter(Activity_Level == "Sedentary") %>%
  pull(sleep_hours)

active_sleep <- fitbit_data %>%
  filter(Activity_Level == "Active") %>%
  pull(sleep_hours)

# Run independent two-sample t-test
t_ind_result <- t.test(sedentary_sleep, active_sleep, var.equal = FALSE)

cat("\nIndependent t-Test (Sedentary vs Active sleep hours):\n")
print(t_ind_result)

# PHASE 2 - TASK D: One-Way ANOVA (Using Sleep Hours as Sleep Quality Proxy)

anova_result <- aov(sleep_hours ~ Activity_Level, data = fitbit_data)

cat("\nANOVA Result (Sleep Hours across Activity Levels):\n")
print(summary(anova_result))

# Post-hoc Tukey test if significant
if(summary(anova_result)[[1]][["Pr(>F)"]][1] < 0.05){
  cat("\nPost-Hoc Tukey HSD Test:\n")
  print(TukeyHSD(anova_result))
}

# PHASE 3 - VISUALIZATIONS


if(!require(ggplot2)) install.packages("ggplot2")
library(ggplot2)

# ✅ 1. Boxplot: Sleep Hours vs Activity Level
ggplot(fitbit_data, aes(x = Activity_Level, y = sleep_hours, fill = Activity_Level)) +
  geom_boxplot() +
  labs(title = "Sleep Hours Across Activity Levels",
       x = "Activity Level",
       y = "Sleep Hours") +
  theme_minimal()

# ✅ 2. Histogram: Daily Steps by Activity Level
ggplot(fitbit_data, aes(x = daily_steps, fill = Activity_Level)) +
  geom_histogram(bins = 30, alpha = 0.7, position = "identity") +
  labs(title = "Daily Steps Distribution by Activity Level",
       x = "Daily Steps",
       y = "Frequency") +
  theme_minimal()

# ✅ 3. Q-Q Plot: Normality check for ANOVA
qqnorm(fitbit_data$sleep_hours,
       main = "Q-Q Plot for Sleep Hours")
qqline(fitbit_data$sleep_hours, col = "red")